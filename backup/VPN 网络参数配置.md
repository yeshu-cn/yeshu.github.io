在创建VPN通道时,需要合理配置VPN的网络参数,主要包括:

1. IP地址和子网掩码
VPN需要为客户端分配一个虚拟IP地址,通常选择私有IP地址段如10.0.0.0/8、172.16.0.0/12、192.168.0.0/16等。子网掩码决定了可分配的IP地址范围。
配置示例:
```java
builder.addAddress("10.0.0.2", 32);
```

2. 路由规则
VPN需要配置路由规则,决定哪些目标地址的流量要走VPN通道。常见的配置是全局路由(0.0.0.0/0),表示所有流量都经过VPN。
配置示例:
```java
builder.addRoute("0.0.0.0", 0);
```

3. DNS服务器
VPN要为客户端指定DNS服务器的地址,可以使用公共DNS服务如8.8.8.8,也可以指定自己的私有DNS服务器。
配置示例:
```java
builder.addDnsServer("8.8.8.8");
```

4. MTU
设置VPN通道的最大传输单元(Maximum Transmission Unit)大小,需要考虑VPN协议头部的开销。常见的值如1400。
配置示例:
```java
builder.setMtu(1400);
```

5. 隧道网关
配置VPN服务器的公网IP地址或域名,作为隧道连接的网关。
示例:
```java
public final String VPN_GATEWAY = "1.2.3.4";  //or "myvpn.example.com"
```

这些配置要求需要满足以下几点:

1. IP地址不能和物理网络产生冲突,通常选择私有地址段;

2. 路由规则要能正确引导客户端的流量进入VPN通道;

3. DNS服务器要稳定可靠,不能劫持或监听用户的DNS查询;

4. MTU的设置要在提高传输效率和避免分片之间权衡,过大可能导致数据包被丢弃;

5. VPN网关的地址需要正确配置,与服务端协议一致,注意网络可达性和防火墙规则。

除了以上功能性的配置,还需要考虑安全性,避免敏感信息泄露、证书校验失败等问题。VPN应用应该提供灵活的配置选项,满足用户的个性化需求。配置不当可能导致VPN连接失败或流量泄露,因此需要谨慎对待。

在`builder.addAddress("10.0.0.2", 32)`中,第二个参数32表示子网掩码的位数,也就是网络前缀长度。

子网掩码用于划分IP地址的网络部分和主机部分,通常用点分十进制表示,如255.255.255.0。但在某些网络配置中,也会使用CIDR(无类别域间路由)表示法,用网络前缀长度来表示子网掩码。

网络前缀长度表示子网掩码二进制中连续1的个数。例如:
- 255.255.255.0 的网络前缀长度为24,因为二进制表示为11111111.11111111.11111111.00000000,前24位都是1。
- 255.255.255.252 的网络前缀长度为30,因为二进制表示为11111111.11111111.11111111.11111100,前30位都是1。

在这个例子中,32位的网络前缀长度表示子网掩码为255.255.255.255,即这个IP地址本身就是一个独立的网络,没有划分主机部分。这种配置通常用于点对点连接或者VPN隧道内部的虚拟IP地址。

所以`builder.addAddress("10.0.0.2", 32)`的作用是给VPN客户端分配一个独立的虚拟IP地址10.0.0.2,这个IP地址的所有32位都用于网络标识,没有主机部分。这种配置可以避免IP地址冲突,适用于一对一的VPN连接场景。

需要注意的是,不同的网络前缀长度会影响可用IP地址的数量:
- /32的网络只有一个可用IP地址
- /31的网络有2个可用IP地址
- /30的网络有4个IP地址,其中2个可用
- /24的网络有256个IP地址,其中254个可用
- ......

因此在配置VPN的IP地址和子网掩码时,需要根据实际的网络拓扑和客户端数量,合理划分网络和主机部分,既要确保IP地址充足,又要避免浪费。